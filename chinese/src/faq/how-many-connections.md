# WorkerMan支持多少并发

**并发**概念太模糊，这里以两种可以量化的指标**并发连接数**和**并发请求数**来说明。

**并发连接数**是指服务器当前时刻一共维持了多少TCP连接，而这些连接上是否有数据通讯并不关注，例如一台消息推送服务器上可能维持了百万的设备连接，由于连接上很少有数据通讯，所以这台服务器上负载可能几乎为0，只要内存足够，还可以继续接受连接。

**并发请求数**一般用QPS（服务器每秒处理多少请求）来衡量，而当前时刻服务器上有多少个tcp连接并不十分关注。例如一台服务器只有10个客户端连接，每个客户端连接上每秒有1W个请求，那么要求服务端需要至少能支撑10*1W=10W每秒的吞吐量（QPS）。假设10W吞吐量每秒是这台服务器的极限，如果每个客户端每秒发送1个请求给服务端，那么这台服务器能够支撑10W个客户端。

**并发连接数**受限于服务器内存，一般24G内存workerman服务器可以支持大概**120W**并发连接。

**并发请求数**受限于服务器cpu处理能力，一台24核workerman服务器可以达到**45W**每秒的吞吐量(QPS)，实际值根据业务复杂度以及代码质量有所变化。

## 注意

高并发场景必须安装libevent扩展，参考安装配置章节。另外需要优化linux内核，尤其是进程打开文件数限制，请参考附录内核调优章节。

## 压测数据
这里仅提供workerman压测的QPS数据参考。


###测试环境：
* **系统**：debian 6.0 64位
* **内存**：64G
* **cpu**：Intel(R) Xeon(R) CPU E5-2420 0 @ 1.90GHz （2颗物理cpu，6核心，2线程）
* **Workerman**：开启200个Benchark进程
* **压测脚本**：benchmark
* **业务**：发送并返回hello字符串

###普通PHP（版本5.3.10）压测
    短链接（每次请求完成后关闭链接，下次请求建立新的链接）:
        条件： 压测脚本开500个并发线程模拟500个并发用户，每个线程链接Workerman 10W次，每次链接发送1个请求
        结果： 吞吐量：2.3W/S ， cpu利用率：36%

    长链接（每次请求后不关闭链接，下次请求继续复用这个链接）:
        条件： 压测脚本开2000个并发线程模拟2000个并发用户，每个线程链接Workerman 1次，每个链接发送10W请求
        结果： 吞吐量：36.7W/S ， cpu利用率：69%

    内存：每个进程内存稳定在6444K，无内存泄漏


###HHVM环境压测
    短链接（每次请求完成后关闭链接，下次请求建立新的链接）:
        条件： 压测脚本开1000个并发线程模拟1000个并发用户，每个线程链接Workerman 10W次，每次链接发送1个请求
        结果： 吞吐量：3.5W/S ， cpu利用率：35%

    长链接（每次请求后不关闭链接，下次请求继续复用这个链接）:
        条件： 压测脚本开6000个并发线程模拟6000个并发用户，每个线程链接Workerman 1次，每个链接发送10W请求
        结果： 吞吐量：45W/S ， cpu利用率：67%

    内存：HHVM环境每个进程内存稳定在46M，无内存泄漏


###### 以上压测脚本与WorkerMan运行在同一台机器上，并且使用的是较低的php版本
